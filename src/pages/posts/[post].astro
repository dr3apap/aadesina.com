---
import type { Post, Comment }  from "../blog/index.astro";
import PostLayout from "../../layouts/PostLayout.astro";
import BlogComment from "../../components/BlogComment.astro";
import HeaderLink from "../../components/HeaderLink.astro";
import BlogCommentForm from "../../components/BlogCommentForm.astro";
import { getAllPostData } from "../../constants/queries";
import { getReadingTime } from "../../utils/readingTime";

export async function getStaticPaths(){
    const posts:Post[] = await getAllPostData();
    return posts.map(({slug, title, postCategory, comments, numOfComment, body, publishedAt, author, description}) => {
        return {
            params:{post:slug.current},
            props:{title, postCategory, numOfComment, comments, body, publishedAt, author, description,},

        };
    });
}
const {
    description,
    title,
    postCategory,
    updated,
    author,
    body,
    publishedAt,
    numOfComment,
    comments,
} = Astro.props;
---

<PostLayout title="Sharing"
ogTitle="A post from Adebola Adesina"
description={description}
>    
<article  class="grid grid-cols-1 gap-y-16">
        <div>
            <img src={author.authorAvatar} alt={`Head shot for ${author.name}`} class="rounded-full" width="80" height="80"/>
            <div>
                <h2>{author.name}</h2>
                <time datetime={publishedAt}
                    >{
                        new Date(publishedAt).toLocaleDateString("en-us", {
                            year: "numeric",
                            month: "short",
                            day: "numeric",
                        })
                    }</time
                >
            </div>
        </div>
            <div class="media__details mb-12">
                <h3 class="text-fluid-2 mb-6">Wrote: {title}</h3>
                <div class="la:flex gap-8">
                    <div class="text-center text-fluid-1 flex gap-2">
                        <iconify-icon
                            class=""
                            icon="tabler:category"
                            style="color:black;"
                            width="24"
                            height="24"></iconify-icon>
                        <span class="la:block">{postCategory.join(" ")}</span>
                    </div>
                    <div class="text-center text-fluid-1 flex gap-2">
                        <iconify-icon
                            class=""
                            icon="fluent-emoji-flat:mantelpiece-clock"
                            style="color: black;"
                            width="24"
                            height="24"
                            class="icon"
                        >
                        </iconify-icon>
                        <span class="">~{getReadingTime(body).readingTime}mins read</span>
                    </div>
                    <div class="text-center text-fluid-1 flex gap-2">
                        <iconify-icon
                            class=""
                            icon="mdi:calendar-month-outline"
                            style="color: black;"
                            width="24"
                            height="24"
                            class="icon"
                        >
                        </iconify-icon>
                        <time datetime={publishedAt}></time>{
                            new Date(publishedAt).toLocaleDateString("en-us", {
                                year: "numeric",
                                month: "short",
                                day: "numeric",
                            })
                        }<time datetime={updated && updated}
                            >{
                                updated &&
                                    new Date(updated).toLocaleDateString(
                                        "en-us",
                                        {
                                            year: "numeric",
                                            month: "short",
                                            day: "numeric",
                                        }
                                    )
                            }</time
                        >
                    </div>
                    <div class="text-center text-fluid-1 flex gap-8">
                        <p class="posts__comment ml-2 text-fluid-1">Comment</p>
                        <span class="block">{numOfComment}</span>
                    </div>
                    <div class="text-center text-fluid-1 flex gap-8">
                        <HeaderLink
                            href="https://www.twitter.com/Dr3_147"
                            class="text-fluid-2 text-fg-dark"
                            target="_blank"
                        >
                            <iconify-icon
                                icon="pajamas:twitter"
                                width="2em"
                                height="1em"
                                class="social"></iconify-icon>
                        </HeaderLink>
                        <span>Share Post</span>
                    </div>
                </div>
            </div>
            <div class="mb-12">{body}</div>
        </article>
        <h3
            class="flex gap-4 text-center before:content-none before:width-[40%] before:h-2 before:bg-gradient-to-r before:from-brand-secondary-light before:to-brand-light after:content-none after:width-[40%] after:h-2 after:bg-gradient-to-l after:from-brand-secondary-light after:to-brand-light mb-12"
        >
            Readers Comments
        </h3>
        <ul class="comments">
          { comments.map((comment:Comment) => <BlogComment comment={comment}/> )}
          <BlogCommentForm/>
        </ul>
</PostLayout>
